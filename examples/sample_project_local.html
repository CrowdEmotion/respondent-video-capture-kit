<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="css/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="css/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="css/style.css">

    <link type="text/css" href="../dist/vrtk-v2.min.css" rel="stylesheet" >
    <script type="text/javascript" charset="utf-8" src="//code.jquery.com/jquery-1.9.1.min.js"></script>

    <script type="text/javascript" charset="utf-8" src="../src/libs/swfobject.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/recorder/var.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/libs/browsercompatibility.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/APIClient/sha256.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/APIClient/enc-base64-min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/APIClient/store.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/APIClient/CEClient.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/libs/video-js-4-7/video.dev.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/vrtk_player.js"></script>
    <script type="text/javascript" charset="utf-8" src="../src/vrtk.js"></script>


    <script type="text/javascript" charset="utf-8">

        // example implementation

        $(document).ready(function(){
            var user_id = getParameterByName('user_id');
            user_id = user_id || (Date.now() + "");
            var fullscreen = getParameterByName('fullscreen');
            fullscreen = (fullscreen==null || fullscreen==undefined)?  false:true;
            var playercentered = getParameterByName('playercentered');
            playercentered = (playercentered==null || playercentered==undefined)? false: true;
            var recordercenter = getParameterByName('recordercenter');
            recordercenter = (recordercenter==null || recordercenter==undefined)? false: true;
            var randomorder = getParameterByName('randomorder');
            randomorder = (randomorder==null || randomorder==undefined)? false: true;


            // one YT video, two YT video, one mp4 video, two MP4 videos

            var rTokens = ['73ab3ef4ce45df9dc109e92b562fc2f0d8d8c09c','0632beb535cd313d37b3686b8e6134585e543493','d331f6ce615640acf0f64a2fdf2d301354a32b88','67e4592ca7787b4348277cd4214ef1c40a295c87'];
            var aTokens = ['9735c2f5-8129-4610-a4b4-7c132d3aa5ca','ac377ece-23e4-4481-b729-f9bae602d17f','ac377ece-23e4-4481-b729-f9bae602d17f','ac377ece-23e4-4481-b729-f9bae602d17f'];

            var researchToken = getParameterByName('r') ?  rTokens[getParameterByName('r')] :  rTokens[0];
            var appToken = getParameterByName('r') ?  aTokens[getParameterByName('r')] :  aTokens[0];

            var options = {

                // ResearchToken and AppToken are obtained using CrowdEmotion Maker web interface.
                // For further details please refer to the documentation.
                //researchToken: '73ab3ef4ce45df9dc109e92b562fc2f0d8d8c09c',
                //appToken: '9735c2f5-8129-4610-a4b4-7c132d3aa5ca',

                researchToken: researchToken,
                appToken: appToken,
                
                // streamName: A prefix that will be used in video recording files generated by
                // respondents (users viewing this page)
                streamName: 'example_',

                // apiSandbox: Activates sandboxing.
                // Must be true during development to avoid charges. Set to false
                // when going in production. Debug as well.
                apiSandbox: true,
                debug: true,

                // Specify a respondent unique name if you like. This will help data analysis.
                // You can also add custom objects and attributes that will be saved with your 
                // analysis (not mandatory).
                respondentName: 'testl',
                respondentCustomData: { name1: 'testname1', lastname1: 'testlastname1' },
                customData: { user_id: user_id },
                playerCentered: playercentered,
                recorderCenter: recordercenter,
                fullscreen: fullscreen,
                randomOrder: randomorder,
                norclick: false
            };

            var vrt = new Vrt(options);

            var alertMessage = function(msg){
                if(msg==undefined || msg==null){
                    $('#alerts').html('');
                    $('#alerts').removeClass('pure-button');
                    $('#alerts').removeClass('button-b');
                }else{
                    $('#alerts').html(msg);
                    $('#alerts').addClass('pure-button');
                    $('#alerts').addClass('button-b');
                }
            };

            $('#alerts').on('click',function(){
                alertMessage();
            });


            // show start button
            $(vrt).on('vrt_event_producer_camera_ok',function(){
                alertMessage();
                $('#start').show();
            });
            // watch first video
            $('#start').on('click',function(){
                alertMessage();
                $('#start').hide();
                $(vrt).trigger('vrt_event_start_video_session');
                if(vrt.continuosPlay!==true)$('#next').show();
            });
            // watch next video
            $(vrt).on('vrt_event_video_step_completed',function(evt, data){
                alertMessage();

                if(data.responseId){
                    alertMessage('Facevideo uploaded with response id: '+ data.responseId);
                    var d = new Date();
                    window.vrt.apiClientSaveCustomData( data.responseId , {time: d.getTime()} );
                }

            });

             $('#next').on('click',function(){
                 if(vrt.continuosPlay!==true) {
                     alertMessage();
                     $(vrt).trigger('vrt_event_user_next_video');
                 }
             });

            //end session
            $(vrt).on('vrt_event_video_session_complete',function(){
                alertMessage();
                $('#next').hide();
                $('#end').show();
            });
            $('#end').on('click',function(){
                alertMessage();
                $('#end').hide();
                $(vrt).trigger('vrt_event_user_session_complete');
            });

            //alerts
            //no api login
            $(vrt).on('vrt_event_api_login_fail',function(){
                alertMessage('Error: API login fail');
                alert('No API login');
            });
            //no camera
            $(vrt).on('vrt_event_producer_no_camera_found',function(){
                alertMessage('Error: No webcam found');
                alert('Your computer have no webcam')
            });
            //camera blocked
            $(vrt).on('vrt_event_producer_camera_blocked',function(){
                alertMessage('Error: Webcam blocked by user');
            });
            //wating user permission for webcam
            $(vrt).on('vrt_event_producer_camera_muted',function(){
                alertMessage('Please click on the "Allow" button in the Adobe Flash Player security request');
            });


            vrt.init();
        });

        function getParameterByName(name) {
            var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
            return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }
    </script>

    <style>
        .hide { display: none; }
        .clearfix { clear: both; }
    </style>

</head>

<body>
<div class="banner">
    <div class="banner-head">
        <span>Playcorder Demo</span>
    </div>
</div>

<div class="content-wrapper">
    <div id="introzone" class="">

        <div id="alerts" class=""></div>

        <div id="buttons"  class="">
            <div id="start" class="hide button-choose pure-button vrtbtn">Start Session</div>
            <div id="next"  class="hide button-choose pure-button vrtbtn">Next video</div>
            <div id="end"  class="hide button-choose pure-button vrtbtn">End</div>
        </div>

    </div>

    <div class="information pure-g">

        <div id="vrt" style="" ></div>

    </div>

    <div class="information pure-g">
        <div id="notice"></div>
    </div>

</div>

</body>
</html>
