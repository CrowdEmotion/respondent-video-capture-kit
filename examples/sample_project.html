<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="css/style.css">

    <link type="text/css" href="../dist/vrtk.min.css" rel="stylesheet" >
    <script type="text/javascript" charset="utf-8" src="libs/jquery-1.9.1.js"></script>
    <script type="text/javascript" charset="utf-8" src="../dist/vrtk.all.js"></script>

    <script type="text/javascript" charset="utf-8">

        // example implementation

        $(document).ready(function(){
            var user_id = getParameterByName('user_id');
            user_id = user_id || makeRandomString();

            var options = {

                // ResearchToken and AppToken are obtained using CrowdEmotion Maker web interface.
                // For further details please refer to the documentation.
                researchToken: '73ab3ef4ce45df9dc109e92b562fc2f0d8d8c09c',
                appToken: '9735c2f5-8129-4610-a4b4-7c132d3aa5ca',
                
                // streamName: A prefix that will be used in video recording files generated by
                // respondents (users viewing this page)
                streamName: 'pds_',

                // apiSandbox: Activates sandboxing.
                // Must be true during development to avoid charges. Set to false
                // when going in production. Debug as well.
                apiSandbox: true,
                debug: true,

                continuosPlay: false,
                randomOrder: true,
                timedOverPlayToEnd: false,

                customData: { user_id: user_id },
                customDataInsertMediaName: true,
                customDataInsertMediaId: true,
                customDataInsertMediaPath: true,

                responseAtStart: true,
                respondentName: 'stefanoc',
                respondentCustomDataString: { name: 'stefano', lastname: 'Ciao' },
                respondentCustomData: { name1: 'stefano1', lastname1: 'Ciao1' },
            };

            var vrt = new Vrt(options);

            var alertMessage = function(msg){
                if(msg==undefined || msg==null){
                    $('#alerts').html('');
                    $('#alerts').removeClass('pure-button');
                    $('#alerts').removeClass('button-b');
                }else{
                    $('#alerts').html(msg);
                    $('#alerts').addClass('pure-button');
                    $('#alerts').addClass('button-b');
                }
            };

            $('#alerts').on('click',function(){
                alertMessage();
            });


            // show start button
            $(vrt).on('vrt_event_producer_camera_ok',function(){
                alertMessage();
                $('#start').show();
            });
            // watch first video
            $('#start').on('click',function(){
                alertMessage();
                $('#start').hide();
                $(vrt).trigger('vrt_event_start_video_session');
                if(vrt.continuosPlay!==true)$('#next').show();
            });
            // watch next video
            $(vrt).on('vrt_event_video_step_completed',function(evt, data){
                alertMessage();

                if(data.responseId){
                    alertMessage('Facevideo uploaded with response id: '+ data.responseId);
                    var d = new Date();
                    window.vrt.apiClientSaveCustomData( data.responseId , {time: d.getTime()} );
                }

            });
            $(vrt).on('vrt_event_frame_close',function(evt, data){
                alertMessage();
                $(vrt).trigger('vrt_event_user_next_video');
                $('#next').show();
            });

             $('#next').on('click',function(){
                 if(vrt.continuosPlay!==true) {
                     alertMessage();
                     $(vrt).trigger('vrt_event_user_next_video');
                 }
             });

            //end session
            $(vrt).on('vrt_event_video_session_complete',function(){
                alertMessage();
                //$('#next').hide();
                $('#end').show();
            });
            $('#end').on('click',function(){
                alertMessage();
                $('#end').hide();
                $(vrt).trigger('vrt_event_user_session_complete');
            });

            //alerts
            //no api login
            $(vrt).on('vrt_event_api_login_fail',function(){
                alertMessage('Error: API login fail');
                alert('No API login');
            });
            //no camera
            $(vrt).on('vrt_event_producer_no_camera_found',function(){
                alertMessage('Error: No webcam found');
                alert('Your computer have no webcam')
            });
            //camera blocked
            $(vrt).on('vrt_event_producer_camera_blocked',function(){
                alertMessage('Error: Webcam blocked by user');
            });
            //wating user permission for webcam
            $(vrt).on('vrt_event_producer_camera_muted',function(){
                alertMessage('Please click on the "Allow" button in the Adobe Flash Player security request');
            });
            //no Flash
            $(vrt).on('vrt_event_flash_no', function(){
                alertMessage('Error: no Adobe Flash founded');
                alert('No Flash detected on your computer');
            });
            //old Flash version
            $(vrt).on('vrt_event_flash_old', function(){
                alertMessage('Error: the version of Adobe Flash is old');
                alert('the version of Adobe Flash on your computer is old');
            });

            vrt.init();
        });

        function getParameterByName(name) {
            var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
            return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }
    </script>

    <style>
        .hide { display: none; }
        .clearfix { clear: both; }
    </style>

</head>

<body>
<div class="banner">
    <div class="banner-head">
        <span>Playcorder Demo</span>
    </div>
</div>

<div class="content-wrapper">
    <div id="introzone" class="information pure-g smallline">

        <div id="alerts" class="pure-u-1 pure-u-md-1"></div>

        <div id="buttons"  class="pure-u-1 pure-u-md-1">
            <button id="start" class="hide button-choose pure-button">Start Session</button>
            <button id="next"  class="hide button-choose pure-button">Next video</button>
            <button id="end"  class="hide button-choose pure-button">End</button>
        </div>

    </div>

    <div class="information pure-g">

        <div id="vrt" style="" ></div>

    </div>

    <div class="information pure-g">
        <div id="notice"></div>
    </div>

</div>

</body>
</html>
