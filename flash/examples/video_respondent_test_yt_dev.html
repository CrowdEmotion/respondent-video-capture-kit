<html>

<!--
    1 - copy and paste file code below, the HEAD part and the BODY part
    2 - fill all data in the videoRespondentTestConf.js
-->

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="css/video_respondent_test.css">
    <link type="text/css" href="../js/vrtk.min.css" rel="stylesheet" >


    <!-- VIDEO  RESPONDENT TEST PAGE - HEAD - START  -->
    <!-- Configuration file  - use the ../js/examples/videoRespondentTestConfYTDev.js as example-->
    <script type="text/javascript" charset="utf-8" src="../js/examples/videoRespondentTestConfYTDev.js"></script>

    <!-- Mandatory files -->
    <script type="text/javascript" charset="utf-8" src="../js/external/jquery-1.9.1.js"></script>

    <!-- Recorder files -->
    <script type="text/javascript" charset="utf-8" src="../js/external/swfobject.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/recorder/webproducer.js"></script>

    <!-- Client files -->
    <script type="text/javascript" charset="utf-8" src="../js/APIClient/sha256.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/APIClient/enc-base64-min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/APIClient/store.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/APIClient/CEClient.js"></script>

    <!-- Video js files -->
    <script type="text/javascript" charset="utf-8" src="../js/video/video-js-4-7/video.dev.js"></script>
    <link type="text/css" href="../js/video/video-js-4-7/video-js.min.css" rel="stylesheet" >

    <!-- Video respondent test kit files -->
    <script type="text/javascript" charset="utf-8" src="../js/video_respondent_test/videoRespondentTestPlayer.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/video_respondent_test/videoRespondentTest.js"></script>

    <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
            var user_id = getParameterByName('user_id');
            (user_id)? '' : user_id = makeRandomString();

            var options = {
                debug:true, debugChrono:  true, debugChronoHtml: false, debugEvt:true, debugVImportant:true,
                randomOrder : true,
                customData:{user_id:user_id}, customDataInsertMediaName: true, customDataInsertMediaId: true, customDataInsertMediaPath : true
                /*, playerCentered:true, playerWidth: 400, playerHeight: 300 */
            };

            var vrt = new Vrt(vrtConf.videoType,vrtConf.videoData,vrtConf.streamDomain,vrtConf.streamName,
                    vrtConf.apiDomain,vrtConf.apiUsername, vrtConf.apiPassword,options
            );

            var alertMessage = function(msg){
                if(msg==undefined || msg==null){
                    $('#alerts').html('');
                    $('#alerts').removeClass('pure-button');
                    $('#alerts').removeClass('button-b');
                }else{
                    $('#alerts').html(msg);
                    $('#alerts').addClass('pure-button');
                    $('#alerts').addClass('button-b');
                }
            };

            $('#alerts').on('click',function(){
                alertMessage();
            });


            // show start button
            $(vrt).on('vrt_event_producer_camera_ok',function(){
                alertMessage();
                $('#start').show();
            });
            // watch first video
            $('#start').on('click',function(){
                alertMessage();
                $('#start').hide();
                $(vrt).trigger('vrt_event_start_video_session');
            });
            // watch next video
            $(vrt).on('vrt_event_video_step_completed',function(evt, data){
                alertMessage();
                //$('#next').show();
                if(data.responseId){
                    alertMessage('Facevideo uploaded with response id: '+ data.responseId);
                }
                vrt.openFrame('https://docs.google.com/forms/d/1afP8KJKFIF3AMfAAjKqaLtLoFIdr5S3rSMRn2FCVyek/viewform',
                        {btnCssClass:'button-choose pure-button', btnPosition:'top',btnText:'Next',btnStyle:'position: static; margin-bottom: 1em;'}
                );
            });
            $(vrt).on('vrt_event_frame_close',function(evt, data){
                alertMessage();
                $(vrt).trigger('vrt_event_user_next_video');
                //$('#next').show();
            });
            /*
            $('#next').on('click',function(){
                alertMessage();
                $('#next').hide();
                $(vrt).trigger('vrt_event_user_next_video');
            });
            */
            //end session
            $(vrt).on('vrt_event_video_session_complete',function(){
                alertMessage();
                $('#next').hide();
                $('#end').show();
            });
            $('#end').on('click',function(){
                alertMessage();
                $('#end').hide();
                $(vrt).trigger('vrt_event_user_session_complete');
            });

            //alerts
            //no api login
            $(vrt).on('vrt_event_api_login_fail',function(){
                alertMessage('Error: API login fail');
                alert('No API login');
            });
            //no camera
            $(vrt).on('vrt_event_producer_no_camera_found',function(){
                alertMessage('Error: No webcam found');
                alert('Your computer have no webcam')
            });
            //camera blocked
            $(vrt).on('vrt_event_producer_camera_blocked',function(){
                alertMessage('Error: Webcam blocked by user');
            });
            //wating user permission for webcam
            $(vrt).on('vrt_event_producer_camera_muted',function(){
                alertMessage('Please click on the "Allow" button in the Adobe Flash Player security request');
            });
            //no Flash
            $(vrt).on('vrt_event_flash_no', function(){
                alertMessage('Error: no Adobe Flash founded');
                alert('No Flash detected on your computer');
            });
            //old Flash version
            $(vrt).on('vrt_event_flash_old', function(){
                alertMessage('Error: the version of Adobe Flash is old');
                alert('the version of Adobe Flash on your computer is old');
            });

            vrt.init();
        });

        function getParameterByName(name) {
            var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
            return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }
    </script>
    <!-- EXAMPLE OF IMPLEMENTATION END -->
    <style>
        .hide{display: none }
        .clearfix{clear: both}
    </style>
</head>

<body>
<div class="banner">
    <div class="banner-head">
        <span>Video Respondent Test Demo</span>
    </div>
    </div>

<div class="content-wrapper">
    <div id="introzone" class="information pure-g smallline">

        <div id="alerts" class="pure-u-1 pure-u-md-1"></div>


        <div id="buttons"  class="pure-u-1 pure-u-md-1">
            <button id="start" class="hide button-choose pure-button">Start Session</button>
            <button id="next"  class="hide button-choose pure-button">Next video</button>
            <button id="end"  class="hide button-choose pure-button">End</button>
        </div>

    </div>

    <div class="information pure-g">

    <!-- VIDEO  RESPONDENT TEST PAGE - BODY - START  -->
    <div id="vrt" style="" ></div>
    <!-- VIDEO  RESPONDENT TEST PAGE - BODY - START -->


    </div>

    <div class="information pure-g">
        <div id="notice"></div>
    </div>

</div>

</body>
</html>